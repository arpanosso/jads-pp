---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->
```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  comment = "#>"
)
```

## Carregando Pacotes
```{r}
library(tidyverse)
```


---

**DESAFIO 1**. Promover o acesso universal à alimentação adequada e saudável, com prioridade para as famílias e pessoas em situação de insegurança alimentar e nutricional  

Temas: Transferência de Renda; Alimentação escolar; Distribuição de alimentos.

1.1	Programa Bolsa Família  
1.1.1	Pessoas Beneficiárias **(OK)**   
1.1.2	 Famílias Beneficiárias **(OK)**    
1.1.3	 Valor Pago  **(OK)**  


```{r}
im <- read_rds("data/im.rds") %>% 
  select(nome,id_municipio:valor_pago_pbf)
data_set <- im %>% filter(ano >= 2010) %>% 
  group_by(nome, ano) %>% 
  summarise(
    familias_beneficiarias_pbf=
      sum(familias_beneficiarias_pbf,na.rm=TRUE)/12,
    pessoas_beneficiarias_pbf=
      sum(pessoas_beneficiarias_pbf,na.rm=TRUE)/12,
    valor_pago_pbf=sum(valor_pago_pbf,na.rm=TRUE))
glimpse(data_set)
```


```{r}
data_set_muni <- data_set %>% 
  group_by(nome) %>% 
  summarise(
    pbf_familias = mean(familias_beneficiarias_pbf, na.rm=TRUE),
    pbf_pessoas = mean(pessoas_beneficiarias_pbf, na.rm=TRUE),
    pbf_valor = mean(valor_pago_pbf, na.rm=TRUE)
  )
```

---

**DESAFIO 2**. Combater a insegurança alimentar e nutricional e promover a inclusão produtiva rural em grupos populacionais específicos, com ênfase em povos e comunidades tradicionais e outros grupos sociais vulneráveis no meio rural.

Temas: Insegurança alimentar e nutricional; Inclusão produtiva rural; Acesso à terra e gestão territorial; Biodiversidade; Saúde indígena; extrativistas e ribeirinhos; Acesso a políticas públicas.

*MACRO DESAFIO*: Promoção de Sistemas Alimentares Saudáveis e Sustentáveis Desafios: o conjunto dos desafios 3, 4 e 5 contemplam este macro desafio.



---

**DESAFIO 3**. Promover a produção de alimentos saudáveis e sustentáveis, a estruturação da agricultura familiar e o fortalecimento de sistemas de produção de base agroecológica

Temas: Fortalecimento da agricultura familiar; Reforma agrária; Transição agroecológica; Mulheres; Juventude; Sementes; Mudanças climáticas.

3.1 Produção de alimentos  
3.2 Área Plantada  **(OK)**  
3.2.1 Área Plantada Agricultura Familiar  
3.2.2 Área Plantada Agricultura não familiar  
3.3. Rendimento Médio  **(OK)**  
3.4 Proporção Área Colhida  **(OK)**  
3.5 Proporção Valor da Produção  **(OK)**  

```{r}
lavoura_permanente <- read_rds("data/permanente.rds") 
lavoura_temporaria <- read_rds("data/temporaria.rds")
lavouras <- rbind(lavoura_permanente %>% 
        mutate(tipo = "permanente"),
      lavoura_temporaria %>% 
        mutate(tipo = "temporaria")
      )
my_na_count <- function(x) sum(is.na(x))
lavouras$na <- apply(lavouras[5:12],1,my_na_count)
lavouras %>% 
  filter(na !=8, ano >= 2010) %>% 
  arrange(ano) %>% 
  relocate(tipo) %>% 
  group_by(tipo,produto) %>% 
  summarise(pvp = sum(prop_valor_producao,na.rm = TRUE)) %>% 
  mutate(produto = fct_reorder(produto, pvp)) %>% 
  ggplot(aes(x=pvp,y=produto,fill=tipo)) +
  geom_col(color="black")+
  facet_wrap(~tipo,scales = "free") + 
  theme_bw()
```


```{r}
# Precisamos resumir lavouras
lavouras <- lavouras %>% 
            filter(na != 8, ano >= 2010,
                   produto != "Café (em grão) Arábica",
                   produto != "Café (em grão) Canephora") %>% 
  select(-na)
lavouras <- lavouras %>% 
  group_by(tipo, ano, nome) %>% 
  summarise(
    n_produtos = n(),
    area_plantada = sum(area_plantada,na.rm=TRUE),
    rendimento_medio = mean(rendimento_medio,na.rm=TRUE),
    prop_area_colhida = mean(prop_area_colhida,na.rm=TRUE) ,
    prop_valor_producao = mean(prop_valor_producao,na.rm=TRUE)
    
  ) %>% 
  pivot_wider(names_from = tipo,
              values_from = n_produtos:prop_valor_producao)

data_set <- left_join(
  data_set,
  lavouras,
  by = c("ano","nome")
)
lavouras_resu <- lavouras %>% 
  group_by(nome) %>% 
  summarize(
    npper = mean(n_produtos_permanente,na.rm=TRUE),           
    nptem = mean(n_produtos_temporaria,na.rm=TRUE),         
    areapper   = mean(area_plantada_permanente,na.rm=TRUE),       
    areapltem  = mean(area_plantada_temporaria,na.rm=TRUE),      
    rendper = mean(rendimento_medio_permanente,na.rm=TRUE),     
    rendtem = mean(rendimento_medio_temporaria,na.rm=TRUE),    
    pacolhidaper = mean(prop_area_colhida_permanente,na.rm=TRUE),     
    pacolhidatem = mean(prop_area_colhida_temporaria,na.rm=TRUE),   
    pvalorpper  = mean(prop_valor_producao_permanente,na.rm=TRUE),  
    pvalortem = mean(prop_valor_producao_temporaria,na.rm=TRUE) 
  )

data_set_muni <- left_join(data_set_muni, lavouras_resu,
          by="nome")
```

---

**DESAFIO 4**. Promover o abastecimento e o acesso regular e permanente da população brasileira à alimentação 

Temas: Compras públicas; Abastecimento; Legislação sanitária; Economia solidaria; Perdas e desperdícios de alimentos; Equipamentos públicos de SAN; Agricultura urbana.

**4.1 Programa da Alimentação Escolar**  
4.1.1 Número de Alunos Beneficiários  **(OK)**  
4.1.2 Valor gasto com Compras da Agricultura Familiar 30%  
4.1.3 Valor Formalizado   
4.1.4 Valor Executado  **(OK)**  

```{r}
pnae_alunos <- read_rds("data/pnae_alunos_atendidos.rds")
glimpse(pnae_alunos)
lista_etapas <- pnae_alunos$etapa_ensino %>% unique()
```
```{r}
pnae_recurso <- read_rds("data/pnae_recurso.rds") 
pnae_recurso <-  pnae_recurso %>% 
  mutate(modalidade_ensino = ifelse(modalidade_ensino == "EJA",
                                    "EDUCAÇÃO DE JOVENS E ADULTOS (EJA)",
                                    modalidade_ensino))
# pnae_recurso$modalidade_ensino %>% unique()
```


```{r}
pnae_recurso <- pnae_recurso %>% 
  group_by(nome, ano, esfera_governo, modalidade_ensino) %>% 
  summarise(vl_total_escolas = mean(vl_total_escolas)) %>% 
  rename(etapa_ensino = modalidade_ensino) %>% 
  filter(etapa_ensino %in% lista_etapas)
```


```{r}
pnae <- left_join(pnae_alunos %>% 
          select(ano:qt_alunos_pnae,nome),
        pnae_recurso,
        by =c("nome","ano","esfera_governo","etapa_ensino"))
# glimpse(pnae)
```

```{r}
# pnae_escola <- read_rds("data/pnae_escolas.rds")
# pnae_conselho <- read_rds("data/pnae_conselho_alim_esco.rds")
```

```{r}
data_set <- left_join(data_set, pnae %>% 
            drop_na() %>% 
            group_by(ano, nome) %>% 
            summarise(qt_alunos_pnae = sum(qt_alunos_pnae,na.rm=TRUE),
                      vl_total_escolas = sum(vl_total_escolas,na.rm=TRUE)
                      ), 
          by=c("ano","nome"))


pnae_resumo <- pnae %>% 
  drop_na() %>% 
  group_by(ano, nome) %>% 
  summarise(qt_alunos_pnae = sum(qt_alunos_pnae,na.rm=TRUE),
            vl_total_escolas = sum(vl_total_escolas,na.rm=TRUE)
  ) %>% filter(ano >=2010) %>% 
  group_by(nome) %>% 
  summarise(
    pnae_qa = mean(qt_alunos_pnae, na.rm=TRUE),
    pnae_vte = mean(vl_total_escolas, na.rm=TRUE)
  )
data_set_muni <- left_join(data_set_muni, pnae_resumo, by = "nome")
```


**4.2 Banco de Leite **  
4.2.1 Próprio  **(OK)**  
4.2.2 Terceirizado  **(OK)**  
**4.3 Serviço Lactário**  
4.3.1 Próprio  **(OK)**  
4.3.2 Terceirizado  **(OK)**  
**4.4 Serviço Nutrição**    
4.4.1 Próprio  **(OK)**  
4.4.2 Terceirizado **(OK)**   


```{r}
sisvan_estab <- read_rds("data/sisvan_estab.rds")
sisvan <- sisvan_estab %>% 
  group_by(municipio, ano) %>% 
  summarise(
    servico_nutricao_proprio = 
      sum(indicador_servico_nutricao_proprio),
    servico_nutricao_terceirizado =  
      sum(indicador_servico_nutricao_terceirizado),
    servico_lactario_proprio = 
      sum(indicador_servico_lactario_proprio),                         
    servico_lactario_terceirizado = 
      sum(indicador_servico_lactario_terceirizado),                    
    servico_banco_leite_proprio = 
      sum(indicador_servico_banco_leite_proprio),                        
    servico_banco_leite_terceirizado=
      sum(indicador_servico_banco_leite_terceirizado),
    # total = trunc(n()/12)
  ) %>% mutate(nome = municipio)
```


```{r}
data_set %>%  glimpse()
sisvan %>%  glimpse()
data_set <- left_join(data_set, sisvan, by = c("ano","nome"))
data_set


sisvan %>%  names
sisvan_resumo <- sisvan %>% 
  group_by(nome) %>% 
  summarise(
    snutrip = mean(servico_nutricao_proprio,na.rm=TRUE),
    snutrit = mean(servico_nutricao_terceirizado,na.rm=TRUE), 
    slacp = mean(servico_lactario_proprio,na.rm=TRUE),
    slact = mean(servico_lactario_terceirizado,na.rm=TRUE), 
    sbleitep = mean(servico_banco_leite_proprio,na.rm=TRUE),
    sbleitet = mean(servico_banco_leite_terceirizado,na.rm=TRUE),
  )
data_set_muni <- left_join(data_set_muni, sisvan_resumo, by = "nome")
```


---

**DESAFIO 5**. Promover e proteger a alimentação adequada e saudável da população brasileira, com estratégias de educação alimentar e nutricional e medidas regulatórias

Temas: Promoção da alimentação saudável; Promoção da alimentação saudável no ambiente escolar; Ações regulatórias; Controle dos riscos relacionados ao consumo de alimentos e a exposição ao uso de agrotóxicos.



---

**DESAFIO 6**. Controlar e prevenir os agravos decorrentes da má alimentação Diretriz correspondente: 5

Temas: Desnutrição; excesso de peso e obesidade; doenças e agravos relacionados à má nutrição. 

6.1 P/I abaixo do percentil 0,1: criança com peso muito baixo para a idade.  
 6.2 P/I maior ou igual ao percentil 0,1 e menor que o percentil 3: criança com peso baixo para a idade.  
 6.3 P/I maior ou igual ao percentil 3 e menor que o percentil 10: criança em risco nutricional.  
 6.4 P/I maior ou igual ao percentil 10 e menor que o percentil 97: criança com peso adequado para a idade (eutrófica).  
 6.5 P/I maior ou igual ao percentil 97: criança com risco de sobrepeso.  
6.6  P/A abaixo do percentil 3: criança com baixo peso para sua altura.  
6.7  P/A maior ou igual ao percentil 3 e menor que o percentil 10: criança com risco de baixo peso para sua altura.  
 6.8 P/A maior ou igual ao percentil 10 e menor que o percentil 97: criança com peso adequado para sua altura.  
 6.9 P/A maior ou igual ao percentil 97: criança com risco de sobrepeso para sua estatura.  
 6.10 A/I abaixo do percentil 3: criança com altura baixa para a idade.  
 6.11 A/I maior ou igual ao percentil 3 e menor que o percentil 10: criança com risco para altura baixa para a idade.  
 6.12 A/I maior ou igual ao percentil 10 e menor que o percentil 97: criança com altura adequada para sua idade.  
 6.13 A/I maior ou igual ao percentil 97: criança com altura elevada para sua idade  
 6.14 Percentil de IMC por idade abaixo de 5: adolescente com baixo peso.  
 6.15 Percentil de IMC por idade maior ou igual a 5 e menor que 85: adolescente com peso adequado (eutrófico).  
 6.16 Percentil de IMC por idade maior ou igual a 85: adolescente com sobrepeso.  
 6.17 Valores de IMC abaixo de 18,5: adulto com baixo peso.  
 6.18 Valores de IMC maior ou igual a 18,5 e menor que 25,0: adulto com peso adequado (eutrófico).  
 6.19 Valores de IMC maior ou igual a 25,0 e menor que 30,0: adulto com sobrepeso.  
 6.20 Valores de IMC maior ou igual a 30,0: adulto com obesidade.  
6.21 índice de Massa Corporal (IMC) para avaliação do estado nutricional de idosos.  
 6.22 Valores de IMC menor ou igual a 22,0: idoso com baixo peso.  
 6.23 Valores de IMC maior que 22,0 e menor que 27,0: idoso com peso adequado (eutrófico).  
 6.24 Valores de IMC maior ou igual a 27,0: idoso com sobrepeso.  
 6.25 Valores de IMC por idade gestacional abaixo da curva inferior: gestante com baixo peso.  
 6.26 Valores de IMC por idade gestacional entre a curva inferior e a segunda curva: gestante com peso adequado (eutrófica).  
 6.27 Valores de IMC por idade gestacional entre a segunda curva e a curva superior: gestante com sobrepeso.  
 6.28 Valores de IMC por idade gestacional acima da curva superior: gestante com obesidade  



```{r}
estado_nutricional <- read_rds("data/df_final.rds") %>% 
  group_by(ano,fase_da_vida,idade,indice,municipio) %>% 
  mutate(valor_p = valor/sum(valor)*100) %>% 
  ungroup()
df_nome <- read_rds("data/df_nome.rds")
estado_nutricional <- left_join(estado_nutricional, 
                                df_nome %>% select(nome, id_municipio_6) %>% 
                       rename(id_municipio  = id_municipio_6),
                     by = c("id_municipio")) %>% 
  select(-regiao,-uf,-codigo_uf,-id_municipio,-municipio,-indice_cri,
         -indice_ado,-valor) %>% relocate(ano,nome) %>% 
  pivot_wider(names_from = c(fase_da_vida,idade,indice,classe),
              values_from = c(valor_p)) %>% 
  janitor::clean_names()


estado_nutricional %>% 
  filter(nome == "Adamantina")

estado_nutri_resumo <- estado_nutricional %>% 
  group_by(nome) %>% 
  mutate(across(crianca_0_4_peso_x_idade_muito_baixo:idoso_imc_sobrepeso,mean)) %>% 
  filter(ano == 2017) %>% 
  select(-ano)

estado_nutri_resumo %>% names
nomes_antigos <- names(estado_nutri_resumo)
novos_nomes <- c(
  "nome"  ,                                      
 "cri04pxi_mb" ,       
 "cri04pxi_b" ,             
 "cri04pxi_a"  ,         
 "cri04pxi_e"  ,          
 "cri510pxi_mb" ,      
 "cri510pxi_b"     ,        
 "cri510pxi_a"  ,        
 "cri510pxi_e"  ,         
 "cri04pxa_magacen", 
 "cri04pxa_mag" ,          
 "cri04pxa_a",          
 "cri04pxa_rsobre",   
 "cri04pxa_sobr",         
 "cri04pxa_obes" ,        
 "cri510pxa_magacen",
 "cri510pxa_mag" ,         
 "cri510pxa_a" ,        
 "cri510pxa_rsobr" , 
 "cri510pxa_sobr" ,       
 "cri510pxa_obes",        
 "cri04axi_mb" ,     
 "cri04axi_b" ,           
 "cri04axi_a" ,        
 "cri510axi_muito_baixa",     
 "cri510axi_b" ,          
 "cri510axi_a",        
 "cri04imcxi_magacen",   
 "cri04imcxi_mag" ,            
 "cri04imcxi_a" ,           
 "cri04imcxi_r_sobr" ,    
 "cri04imcxi_sobr",           
 "cri04imcxi_obes",           
 "cri510imcxi_magacen",  
 "cri510imcxi_mag" ,           
 "cri510imcxi_a" ,          
 "cri510imcxi_rsobr",    
 "cri510imcxi_sobr",          
 "cri510imcxi_obes",          
 "adolaxi_mb",      
 "adolaxi_b",            
 "adolaxi_a" ,        
 "adolimcxi_magacen",   
 "adolimcxi_mag",             
 "adolimcxi_a",            
 "adolimcxi_sobr",           
 "adolimcxi_obes"  ,         
 "adolimcxi_obesgra",     
 "adulimc_b" ,                      
 "adulimc_a",                         
 "adulimc_sob" ,                       
 "adulimc_obesg_i",                
 "adulimc_obesg_ii"  ,              
 "adulimc_obesg_iii",               
 "idimc_b",                        
 "idimc_a" ,                         
 "idimc_sob"
)
estado_nutri_resumo <- estado_nutri_resumo %>% 
  rename_at(vars(nomes_antigos), ~novos_nomes)
```

7. Consumo   
7.1 Consumo de ultra processados **(OK)** 
7.1.2 Consumo embutidos  **(OK)**
7.1.3 Consumo processados  **(OK)**

```{r}
consumo <- read_rds("data/consumo/consumo.rds")
consumo <- left_join(consumo, df_nome %>% select(nome, id_municipio_6) %>% 
                       rename(codigo_ibge = id_municipio_6) %>%
                       mutate(codigo_ibge = as.numeric(codigo_ibge)),
                     by = c("codigo_ibge"))
consumo$tipo_relatorio %>%  unique()

tipos_relat <- c("CONS_ULTRA","CONS_EMBUT")

consumo <- consumo %>% select(-faixa_etaria, -codigo_ibge, -municipio,
                   -uf, -total, -monitorados) %>% 
  filter(tipo_relatorio %in% tipos_relat,
         fase_da_vida != "entre-6-meses-23-meses")

consumo <- consumo %>% 
  pivot_wider(names_from = c(fase_da_vida,tipo_relatorio),
              values_from = percent) %>% 
  janitor::clean_names()
```



```{r}
consumo_estado_nutricional <- left_join(consumo, estado_nutricional,
          by=c("ano","nome"))
data_set <- left_join(data_set,consumo_estado_nutricional,
          by=c("ano","nome")) %>% 
  select(-municipio)
glimpse(data_set)

consumo_resumo <- consumo %>% 
  group_by(nome) %>% 
  summarise(
    adol_embut = mean(adolecentes_cons_embut,na.rm=TRUE),  
    adol_ultra = mean(adolecentes_cons_ultra,na.rm=TRUE), 
    adul_embut = mean(adultos_cons_embut,na.rm=TRUE), 
    adul_ultra = mean(adultos_cons_ultra,na.rm=TRUE),     
    cri24_embut = mean(criancas_2_4_cons_embut,na.rm=TRUE),
    cri24_ultra = mean(criancas_2_4_cons_ultra,na.rm=TRUE), 
    cri59_embut = mean(criancas_5_9_cons_embut,na.rm=TRUE),
    cri59_ultra = mean(criancas_5_9_cons_ultra,na.rm=TRUE),
    ido_embut = mean(idosos_cons_embut,na.rm=TRUE),      
    ido_ultra = mean(idosos_cons_ultra,na.rm=TRUE)      
  )

consumo_estado_nutricional_resumo <- left_join(estado_nutri_resumo, consumo_resumo,
          by = "nome") 
data_set_muni <- left_join(data_set_muni,
                           consumo_estado_nutricional_resumo,
                           by = "nome")
```


---

**DESAFIO 7**.  Ampliar a disponibilidade hídrica e o acesso à água para a população, em especial a população pobre no meio rural

Temas: Água para consumo humano; Água para a produção de alimentos; Recursos hídricos; Saneamento básico rural

---

**DESAFIO 8**. Consolidar a implementação do sistema nacional de segurança alimentar e nutricional (SISAN), aperfeiçoando a gestão federativa, a intersetorialidade e a participação social Diretrizes correspondentes: 3 e 8 (envolve ainda as diretrizes da LOSAN)

Temas: Intersetorialidade nas ações federativas; Participação social; Gestão e financiamento do Sistema; Formação, pesquisa e extensão em SAN e DHAA; Exigibilidade e monitoramento do DHAA


---

**DESAFIO 9**. Apoio às iniciativas de promoção da soberania, segurança alimentar e nutricional, do direito humano à alimentação adequada e de sistemas alimentares democráticos, saudáveis e sustentáveis em âmbito internacional, por meio do diálogo e da cooperação internacional

Temas: Governança global; Cooperação internacional; Participação da sociedade civil

---

**DESAFIO 10**. Socioeconômica

10.1Índice de Vulnerabilidade Social  Dimensão Capital Humano  
10.2 Índice de Vulnerabilidade Social  Dimensão Renda e Trabalho  
10.3  Índice de Desenvolvimento Humano Municipal  
 10.4 ndice de Desenvolvimento Humano Municipal Dimensão Longevidade  
 10.5 Índice de Desenvolvimento Humano Municipal  Dimensão Educação  
 10.6 Índice de Desenvolvimento Humano Municipal  Dimensão Renda  
 10.7 Índice de Desenvolvimento Humano Municipal  Dimensão Sub Escolaridade  
 10.8 Índice de Desenvolvimento Humano Municipal  Dimensão Frequência Escolar  
10.9 Índice Gini  
10.10 Renda Per capita  
10.11 Proporção de empregados com carteira assinada com 18 anos ou mais  
 10.12 Proporção de empregados sem carteira assinada com 18 anos ou mais  
 10.13 Proporção de trabalhadores do setor público com 18 anos ou mais  
 10.14 Proporção de trabalhadores por conta própria com 18 anos ou mais  
 10.15 Proporção de empregadores com 18 anos ou mais  
10.6 Proporção do grau formalização dos ocupados com 18 anos ou mais  
 10.7 Proporção de atividade das pessoas de 10 a 14 anos de idade  
10.8 População Economicamente Ativa (PEA) com 10 anos ou mais  
 10.9 População Economicamente Ativa (PEA) com 10 a 14 anos  
10.10 População Economicamente Ativa (PEA) com 15 a 17 anos  
10.11 População Economicamente Ativa (PEA) com 18 anos ou mais  

---


# Análise multivariada

```{r}
library(readxl)
library(tidyverse)
library(vegan)
library(corrplot)
source("R/my-functions.R")
theme_set(theme_bw())
```


```{r}
da <- data_set_muni %>% ungroup()
glimpse(da)
```


```{r}
nomes <- data_set_muni$nome
da_pad <- decostand(da[-1] , 
                      method = "standardize",
                      na.rm=TRUE)

da_pad$nome <- nomes
da_pad <- da_pad %>% 
  select(-nome)


da_pad_euc<-vegdist(da_pad,"euclidean",na.rm=TRUE) 
da_pad_euc_ward<-hclust(da_pad_euc, method="ward.D")
plot(da_pad_euc_ward, 
     ylab="Distância Euclidiana",
     xlab="Acessos", hang=-1,
     col="blue", las=1,
     cex=.6,lwd=1.5);box()
grupo<-cutree(da_pad_euc_ward,3)
```


```{r}
da_pad$gp <- grupo
da_pad$nomes <- nomes

da_pad_gp <- da_pad %>% 
  select(-gp, -nomes)

gp <- da_pad %>% 
  pull(gp)

nome <- da_pad %>% 
  pull(nomes)

df <- da_pad_gp %>% 
  select(pbf_familias:cri04pxa_obes) %>% 
  drop_na()

pca <-  prcomp(df,
               scale=T)
```


```{r}
# Autovalores
eig<-pca$sdev^2
print(round(eig,3))
ve<-eig/sum(eig)
print(round(ve,4))
print(round(cumsum(ve),4)*100)
mcor<-cor(df,pca$x)
corrplot(mcor)
screeplot(pca)
abline(h=1)
pc1V<-cor(df,pca$x)[,1]/sd(cor(df,pca$x)[,1])
pc2V<-cor(df,pca$x)[,2]/sd(cor(df,pca$x)[,2])
pc3V<-cor(df,pca$x)[,3]/sd(cor(df,pca$x)[,3])
pc1c<-pca$x[,1]/sd(pca$x[,1])
pc2c<-pca$x[,2]/sd(pca$x[,2])
pc3c<-pca$x[,3]/sd(pca$x[,3])
nv<-ncol(df)
```

```{r}
bip<-data.frame(pc1c,pc2c,pc3c)#,nome)
```


```{r}
texto <- data.frame(
  x = pc1V,
  y = pc2V,
  z = pc3V,
  label = names(df)
)

bip %>% 
  ggplot(aes(x=pc1c, y=pc2c))+
  geom_point() +
  coord_cartesian(xlim=c(-2,10)) +
  # geom_point(aes(shape = nomes, color = nomes), size = 3)+ theme_minimal()+
  #scale_shape_manual(values=16:19)+
  #scale_color_manual(values=c("#009E73", "#999999","#D55E00", "#A6761D"))+
  #annotate(geom="text", x=pc1V, y=pc2V, label=names(pc1V),
  #            color="black",font=3)+
  geom_vline(aes(xintercept=0),
             color="black", size=1) +
  geom_hline(aes(yintercept=0),
             color="black", size=1) +
  annotate(geom="segment",
           x=rep(0,length(df)),
           xend=texto$x,
           y=rep(0,length(df)),
           yend=texto$y,color="black",lwd=.5) +
  geom_label(data=texto,aes(x=x,y=y,label=label),
             color="black",angle=0,fontface="bold",size=4,fill="white") +
  labs(x=paste("CP1 (",round(100*ve[1],2),"%)",sep=""),
       y=paste("CP2 (",round(100*ve[2],2),"%)",sep=""),
       color="",shape="") +
  theme(legend.position = "top")
```

```{r}
# ck<-sum(pca$sdev^2>=0.98)
# tabelapca<-vector()
# for( l in 1:ck) tabelapca<-cbind(tabelapca,mcor[,l])
# colnames(tabelapca)<-paste(rep(c("PC"),ck),1:ck,sep="")
# pcat<-round(tabelapca,3)
# tabelapca<-tabelapca[order(abs(tabelapca[,1])),]
# print(tabelapca)
```

